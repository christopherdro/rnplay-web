#!/usr/bin/env ruby
#
name = Dir.pwd.split("/").last.split(".").first
target = "/rails/app_js/#{name}"

def npm_install(target)
  puts `cd #{target} && npm install`
  puts `rm -rf #{target}/node_modules/react-native`
end

if File.exists?(target)
  puts `git --work-tree #{target} --git-dir #{target}/.git fetch origin && git --work-tree #{target} --git-dir #{target}/.git reset --hard origin/master && chown -R 9999:9999 #{target}`
  npm_install(target)
else
  puts `git clone /var/repos/#{name}.git /rails/app_js/#{name} & chown -R 9999:9999 #{target}`
  npm_install(target)
end
